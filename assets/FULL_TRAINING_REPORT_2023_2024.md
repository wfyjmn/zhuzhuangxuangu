# AI 裁判 V5.0 完整训练报告（2023-2024 年真实数据）

## 训练时间
2026-01-30 06:27:23 ~ 2026-01-30 06:28:35

## 训练配置

```python
TRAINING_CONFIG = {
    'start_date': '20230101',     # 开始日期
    'end_date': '20241231',       # 结束日期
    'amount_threshold': 10000,    # 成交额阈值（千元）
    'max_candidates': 100,        # 每日最大候选股票数
    'max_samples': 10000,         # 最大样本数
    'n_splits': 5,                # 交叉验证折数
    'model_type': 'xgboost',      # 模型类型
    'use_float32': True,          # 内存优化
}
```

---

## 训练结果

### 1. 数据生成阶段

✅ **Turbo 模式启动成功**
- 数据预加载：236.68 MB
- 内存表行数：2,553,767
- 读取文件数：491 个

✅ **训练数据生成成功**
- 样本总数：10,036
- 正样本：2,022 (20.15%)
- 负样本：8,014 (79.85%)
- 文件大小：1.76 MB
- 保存路径：`/workspace/projects/data/training/training_data_20260130_062754.csv`

⚠️ **数据范围异常**
- 配置要求：20230101 ~ 20241231（2 年）
- 实际范围：20230403 ~ 20230901（仅 5 个月）
- 原因：达到最大样本数限制（10,000），提前停止

### 2. 模型训练阶段

✅ **5折时序交叉验证完成**

| Fold | 训练区间 | 验证区间 | AUC | Accuracy | Precision | Recall |
|------|---------|---------|-----|----------|-----------|--------|
| 1 | 20230403~20230427 | 20230427~20230525 | 0.4685 | 0.7004 | 0.1628 | 0.1644 |
| 2 | 20230403~20230525 | 20230525~20230619 | 0.4982 | 0.6525 | 0.3302 | 0.1398 |
| 3 | 20230403~20230619 | 20230619~20230714 | 0.4946 | 0.7135 | 0.1548 | 0.1811 |
| 4 | 20230403~20230714 | 20230714~20230808 | 0.4665 | 0.6824 | 0.1585 | 0.1200 |
| 5 | 20230403~20230808 | 20230808~20230901 | 0.5322 | 0.7578 | 0.1533 | 0.1953 |

**平均指标**：
- 平均 AUC: 0.4920 (±0.0267)
- 平均 Accuracy: 0.7013
- 平均 Precision: 0.1720
- 平均 Recall: 0.1601

✅ **模型保存成功**
- 模型文件：`/workspace/projects/data/models/ai_referee_xgboost_20260130_062835.pkl`
- 特征重要性：`/workspace/projects/data/models/feature_importance_20260130_062835.csv`

---

## 特征重要性分析

### Top 10 重要特征

| 排名 | 特征 | 重要性 | 说明 |
|------|------|--------|------|
| 1 | macd_dea | 0.0832 | MACD DEA 线 |
| 2 | position_20d | 0.0812 | 20日相对位置 |
| 3 | std_20_ratio | 0.0810 | 20日波动率 |
| 4 | ma5_slope | 0.0808 | 5日均线斜率 |
| 5 | bias_20 | 0.0790 | 20日乖离率 |
| 6 | ma20_slope | 0.0787 | 20日均线斜率 |
| 7 | macd_hist | 0.0779 | MACD 红绿柱 |
| 8 | macd_dif | 0.0759 | MACD DIF 线 |
| 9 | rsi_14 | 0.0754 | RSI 指标 |
| 10 | bias_5 | 0.0731 | 5日乖离率 |

### 特征数据质量分析

| 特征 | 非零占比 | 状态 | 说明 |
|------|---------|------|------|
| vol_ratio | 100.0% | ✅ | 量比数据完整 |
| turnover_rate | 0.0% | ❌ | 换手率数据缺失 |
| pe_ttm | 0.0% | ❌ | 市盈率数据缺失 |
| pct_chg_1d | 99.1% | ✅ | 1日涨跌幅 |
| pct_chg_5d | 99.6% | ✅ | 5日涨跌幅 |
| pct_chg_20d | 99.9% | ✅ | 20日涨跌幅 |
| ma5_slope | 99.6% | ✅ | 5日均线斜率 |
| ma20_slope | 99.9% | ✅ | 20日均线斜率 |
| bias_5 | 100.0% | ✅ | 5日乖离率 |
| bias_20 | 100.0% | ✅ | 20日乖离率 |
| rsi_14 | 100.0% | ✅ | RSI 指标 |
| std_20_ratio | 100.0% | ✅ | 20日波动率 |
| position_20d | 92.5% | ✅ | 20日相对位置 |
| position_250d | 0.0% | ❌ | 250日相对位置（数据不足） |
| macd_dif | 100.0% | ✅ | MACD DIF |
| macd_dea | 100.0% | ✅ | MACD DEA |
| macd_hist | 100.0% | ✅ | MACD 红绿柱 |
| index_pct_chg | 0.0% | ❌ | 大盘涨跌幅（缺失） |
| sector_pct_chg | 0.0% | ❌ | 板块涨跌幅（缺失） |
| moneyflow_score | 0.0% | ❌ | 资金流得分（未启用） |
| tech_score | 0.0% | ❌ | 技术形态得分（未启用） |
| new_score | 0.0% | ❌ | 综合得分（未启用） |

---

## 问题分析

### 1. ⚠️ 模型性能不理想

**AUC = 0.4920**（接近随机水平 0.5）

**可能原因**：
1. **数据范围太短**：实际只有 5 个月数据（20230403~20230901），远少于配置的 2 年
2. **关键特征缺失**：
   - 大盘指数数据（index_pct_chg）：导致相对收益标签失效
   - 板块数据（sector_pct_chg）：缺失环境特征
   - 评分系统（moneyflow_score、tech_score、new_score）：未启用
   - 长期位置（position_250d）：数据不足
3. **样本不平衡**：正样本占比 20.15%，虽然不算极低，但仍有改善空间
4. **特征同质化**：技术指标之间相关性高，缺乏差异化信息

### 2. ⚠️ 相对收益标签失效

**警告信息**：
```
[警告] 未找到大盘指数数据，相对收益标签将失效（退化为绝对收益）
```

**影响**：
- 模型学习的是绝对收益（>3%），而不是相对收益（跑赢大盘）
- 在熊市中，模型无法正确识别"跑赢大盘"的股票
- 导致模型泛化能力下降

### 3. ⚠️ 评分系统未启用

**影响**：
- 资金流、技术形态、综合评分等重要信号未使用
- 降低了模型的决策能力
- 特征重要性显示这些特征重要性为 0

### 4. ⚠️ 数据范围不足

**配置 vs 实际**：
- 配置要求：20230101 ~ 20241231（2 年）
- 实际范围：20230403 ~ 20230901（5 个月）
- 差异：达到 max_samples 限制（10,000）提前停止

**影响**：
- 无法覆盖完整的市场周期（牛熊转换）
- 样本多样性不足
- 模型泛化能力受限

---

## 改进建议

### 1. 增加样本数量上限

```python
TRAINING_CONFIG = {
    'max_samples': 50000,  # 从 10,000 增加到 50,000
}
```

### 2. 启用评分系统

在数据生成时启用评分系统计算：
```python
generator.enable_scoring = True  # 启用资金流、技术形态、综合评分
```

### 3. 补充大盘指数数据

下载大盘指数数据（如上证指数、深证成指），使相对收益标签生效：
```python
# 下载上证指数数据
dw.download_index_data('000001.SH', '20230101', '20241231')
```

### 4. 优化样本平衡

使用 `scale_pos_weight` 参数处理样本不平衡：
```python
model_params = {
    'scale_pos_weight': neg_count / pos_count,  # 负样本数 / 正样本数
}
```

### 5. 增加特征多样性

- 补充换手率数据（turnover_rate）
- 补充市盈率数据（pe_ttm）
- 补充板块数据（sector_pct_chg）

### 6. 扩大回测窗口

使用更长的回测窗口计算标签：
```python
generator.holding_days = 10  # 从 5 天增加到 10 天
```

---

## 训练总结

### ✅ 成功项

1. ✅ Turbo 模式运行正常（数据预加载 236.68 MB）
2. ✅ 成功生成 10,036 个训练样本
3. ✅ 5折时序交叉验证完成
4. ✅ 模型保存成功
5. ✅ 特征重要性导出成功
6. ✅ 技术指标特征数据完整（MACD、均线、RSI等）

### ⚠️ 问题项

1. ⚠️ 模型性能不理想（AUC = 0.4920）
2. ⚠️ 相对收益标签失效（缺失大盘数据）
3. ⚠️ 评分系统未启用（重要性为 0）
4. ⚠️ 数据范围不足（5 个月 vs 2 年）
5. ⚠️ 关键特征缺失（换手率、市盈率、板块等）

### 📊 核心指标

| 指标 | 数值 | 评价 |
|------|------|------|
| 平均 AUC | 0.4920 | ⚠️ 接近随机 |
| 平均 Accuracy | 0.7013 | ✅ 尚可 |
| 平均 Precision | 0.1720 | ⚠️ 较低 |
| 平均 Recall | 0.1601 | ⚠️ 较低 |
| 正样本占比 | 20.15% | ⚠️ 偏低 |

### 🎯 关键发现

1. **技术指标主导**：前 10 重要特征都是技术指标
2. **量价特征缺失**：vol_ratio 虽然完整，但 turnover_rate、pe_ttm 缺失
3. **环境特征无效**：index_pct_chg、sector_pct_chg 全为 0
4. **评分系统未使用**：moneyflow_score、tech_score、new_score 全为 0

---

## 结论

本次训练成功完成了数据生成、模型训练和特征重要性分析的完整流程，证明了训练流程的可行性。

但是，由于数据范围不足、关键特征缺失、相对收益标签失效等原因，模型性能不理想（AUC = 0.4920）。

**下一步行动**：
1. 增加样本数量上限（50,000+）
2. 补充大盘指数数据
3. 启用评分系统
4. 优化特征工程
5. 重新训练并评估模型

---

**报告生成时间**: 2026-01-30 06:28:35
**报告生成者**: Coze Coding
