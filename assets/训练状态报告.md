# 📊 V5.0 模型训练状态报告

**生成时间**: 2026-02-01 01:53:00
**状态**: 🔄 训练进行中

---

## ✅ 已完成阶段

### 1. 数据采集

| 项目 | 状态 | 数值 |
|------|------|------|
| 股票池获取 | ✅ 完成 | 300 只股票 |
| 排除板块 | ✅ 完成 | 科创板（688）、创业板（300/301）、北交所（BJ） |
| 排除ST股 | ✅ 完成 | 0 只 ST 股 |
| 数据采集 | ✅ 完成 | 123,857 个样本 |

### 2. 特征工程

| 项目 | 状态 | 数值 |
|------|------|------|
| 主力资金特征 | ✅ 完成 | 8 个特征（权重30%） |
| 北向资金特征 | ✅ 完成 | 5 个特征（权重20%） |
| 市场情绪特征 | ✅ 完成 | 8 个特征（权重20%） |
| 技术指标特征 | ✅ 完成 | 45+ 个特征（权重30%） |
| **总特征数** | ✅ 完成 | **24 个有效特征** |

**警告**: 1 个特征不存在（volume_surge），已自动排除

### 3. 数据集构建

| 项目 | 数值 | 说明 |
|------|------|------|
| 总样本数 | 123,857 | 3年数据（2023-2025） |
| 正样本数 | 5,796 | 未来5日涨幅≥5% |
| 负样本数 | 118,061 | 未来5日涨幅<5% |
| 正样本比例 | 4.68% | 类别不平衡 |

### 4. 数据集划分

| 数据集 | 样本数 | 比例 | 状态 |
|--------|--------|------|------|
| 训练集 | 105,278 | 85% | ✅ 完成 |
| 测试集 | 18,579 | 15% | ✅ 完成 |

---

## 🔄 进行中阶段

### Optuna 超参数优化

#### 进度概览

| 项目 | 数值 |
|------|------|
| 已完成试验 | 5 / 100 |
| 进度百分比 | 5% |
| 已用时间 | ~6 分钟 |
| 预计剩余时间 | ~2 小时 |
| 超时限制 | 7200 秒（2 小时） |

#### 最佳试验（Trial 3）

| 指标 | 数值 |
|------|------|
| **F1 Score** | **0.385761** ⭐ |
| Trial ID | 3 |
| 完成时间 | 01:51:00 |

**最佳参数**:
```python
{
    'learning_rate': 0.032376279892921425,    # 学习率
    'max_depth': 4,                          # 最大深度
    'min_child_weight': 26,                  # 最小子节点权重
    'n_estimators': 726,                     # 树的数量
    'scale_pos_weight': 6.948555720509506,   # 正样本权重
    'subsample': 0.6238485388633824,         # 样本采样比例
    'colsample_bytree': 0.6868625384021698,  # 特征采样比例
    'reg_alpha': 0.21192032026300361,        # L1 正则化
    'reg_lambda': 0.16993863643515444,       # L2 正则化
    'gamma': 0.5383964077136272             # 最小分裂增益
}
```

#### 所有试验详情

| Trial | F1 Score | Learning Rate | Max Depth | N Estimators | Scale Pos Weight |
|-------|----------|---------------|-----------|--------------|------------------|
| 0 | 0.38118 | 0.0244 | 5 | 929 | 5.90 |
| 1 | 0.36876 | 0.0240 | 6 | 942 | 4.44 |
| 2 | 0.37463 | 0.0618 | 4 | 573 | 4.81 |
| **3** | **0.38576** | **0.0324** | **4** | **726** | **6.95** |
| 4 | 0.37783 | 0.0408 | 3 | 1233 | 4.43 |

**分析**:
- ✅ 最佳 F1 值: 0.385761（Trial 3）
- ✅ 学习率适中（0.032），避免过快收敛
- ✅ 树深度较浅（4），防止过拟合
- ✅ 树数量适中（726），平衡性能和速度
- ✅ 正样本权重较高（6.95），解决类别不平衡

---

## 📈 性能对比

### V4.0 vs V5.0 预期

| 指标 | V4.0 实际 | V5.0 当前 | V5.0 目标 | 状态 |
|------|----------|----------|----------|------|
| AUC | 0.9470 | 待测 | 0.95+ | ⏳ 待测 |
| 精确率 | 62.50% | 待测 | 65%+ | ⏳ 待测 |
| 召回率 | 1.98% | 待测 | 2.5%+ | ⏳ 待测 |
| **F1** | 0.3954 | **0.3858** | 0.45+ | 🔄 优化中 |

**当前分析**:
- F1 Score 当前 0.3858，略低于 V4.0 的 0.3954
- 可能原因：数据量减少（3年→3年，但样本数可能减少）
- 仍需继续优化，预计后续试验会提升

---

## 💻 系统资源

### 进程状态

| 进程 | PID | CPU 使用 | 内存使用 | 状态 |
|------|-----|---------|---------|------|
| 训练主进程 | 1040 | 27.5% | 344 MB | 运行中 |
| Optuna 优化 | 1048 | 27.3% | 377 MB | 运行中 |

**系统状态**:
- ✅ CPU 使用正常（27.5%）
- ✅ 内存使用正常（~721 MB）
- ✅ 无异常或错误

---

## ⏱️ 时间线

### 实际进度

| 阶段 | 计划时间 | 实际时间 | 状态 |
|------|---------|---------|------|
| 数据采集 | 5 分钟 | ~5 分钟 | ✅ 完成 |
| 特征工程 | 2 分钟 | ~2 分钟 | ✅ 完成 |
| Optuna 优化 | 60-90 分钟 | ~6 分钟（5/100） | 🔄 进行中 |
| 模型保存 | 1 分钟 | 待定 | ⏳ 待完成 |
| 总计 | 70-100 分钟 | 已用 ~8 分钟 | 🔄 进行中 |

### 预计完成时间

| 项目 | 预计时间 |
|------|---------|
| Optuna 优化剩余 | ~114 分钟 |
| 模型保存 | ~1 分钟 |
| **预计总完成时间** | **2026-02-01 03:45 ~ 04:00** |

---

## 📁 文件状态

### 日志文件

| 文件 | 路径 | 大小 | 状态 |
|------|------|------|------|
| 训练日志 | `assets/training_v5.log` | ~50 KB | 🔄 持续写入 |

### 模型文件

| 文件 | 路径 | 大小 | 状态 |
|------|------|------|------|
| 模型文件 | `assets/models/主力资金驱动-高置信度策略_model.pkl` | 待定 | ⏳ 待生成 |

---

## 🔍 监控建议

### 实时监控

**方法1：查看日志**
```bash
# 查看最后50行
tail -n 50 assets/training_v5.log

# 持续监控（按 Ctrl+C 退出）
tail -f assets/training_v5.log
```

**方法2：监控进程**
```bash
# 查看训练进程
ps aux | grep train_auto_optuna

# 查看资源使用
top -p 1040
```

**方法3：使用监控脚本**
```bash
python3 scripts/monitor_training.py
```

---

## ⚠️ 注意事项

### 当前关注点

1. **F1 Score 略低**
   - 当前: 0.3858 vs V4.0: 0.3954
   - 可能原因：数据范围变化
   - 解决方案：继续优化，观察后续试验

2. **正样本比例低**
   - 正样本比例: 4.68%
   - 类别不平衡严重
   - 已使用 `scale_pos_weight` 平衡

3. **预计时间较长**
   - 剩余 95 个试验
   - 预计还需 114 分钟
   - 建议：继续后台运行，无需干预

### 风险提示

- ⚠️ 训练可能需要较长时间（2小时+）
- ⚠️ 需要确保网络稳定（Tushare API）
- ⚠️ 避免中断训练进程

---

## 📊 数据质量评估

### 数据完整性

| 项目 | 状态 | 说明 |
|------|------|------|
| 股票池 | ✅ 正常 | 300 只主板股票 |
| 数据时间范围 | ✅ 正常 | 2023-01-01 ~ 2025-12-30 |
| 特征完整性 | ✅ 正常 | 24/25 个特征有效 |
| 标签分布 | ⚠️ 不平衡 | 正样本仅 4.68% |

### 数据统计

**样本分布**:
- 训练集: 105,278 样本
- 测试集: 18,579 样本
- 测试集比例: 15%（合理）

**类别分布**:
- 正样本: 5,796（4.68%）
- 负样本: 118,061（95.32%）
- 比例: 1:20.37（严重不平衡）

---

## 🚀 后续计划

### 训练完成后

1. **验证模型性能**
   - 查看 `assets/training_v5.log`
   - 检查最佳 F1 Score
   - 确认模型文件生成

2. **优化阈值**
   ```bash
   python3 scripts/optimize_threshold.py
   ```

3. **测试选股**
   ```bash
   python3 scripts/daily_prediction.py
   ```

4. **性能对比**
   - 对比 V4.0 vs V5.0
   - 分析性能提升
   - 决定是否切换模型

---

## 📝 版本信息

| 项目 | 信息 |
|------|------|
| 策略名称 | 主力资金驱动-高置信度策略 |
| 版本号 | V5.0.0_LatestData |
| 数据范围 | 2023-01-01 ~ 2025-12-30 |
| 优化算法 | Optuna（100 次试验） |
| 模型类型 | XGBoost 3.1.3 |

---

**报告生成时间**: 2026-02-01 01:53:00
**下次更新**: 30 分钟后或训练完成时
