# 🏦 自动提款机模式使用指南

## 📊 模式对比

| 指标 | 选股雷达（默认） | 自动提款机（优化后） |
|------|----------------|-------------------|
| 阈值 | 0.5 | 0.6499 |
| 精确率 | 26.57% | **62.50%** |
| 召回率 | 77.21% | 1.98% |
| 选股数量 | 200只 → 约53只 | 200只 → 约2只 |
| 特点 | 广撒网，数量多 | 精准狙击，质量高 |

**核心改进**：精确率提升 2.35 倍（26.57% → 62.50%），每买10只股票，从 2 只大涨提升到 **6 只大涨**！

---

## 🚀 快速开始

### 步骤 1：优化阈值（每月执行一次）

```bash
python3 scripts/optimize_threshold.py
```

**功能**：
- 加载训练好的模型
- 获取最近 2 个月数据作为验证集
- 计算 PR 曲线
- 找到能达到 60% 精确率的最低阈值

**输出**：
- 配置文件：`config/atm_strategy_config.json`
- 日志文件：`assets/threshold_optimization.log`

**执行频率**：建议每月执行一次，根据市场变化调整阈值。

---

### 步骤 2：日常选股（每日收盘后执行）

```bash
python3 scripts/daily_prediction.py
```

**功能**：
- 加载模型和优化后的阈值
- 获取股票池（200 只股票）
- 进行特征工程
- 预测概率
- 筛选置信度 ≥ 阈值的股票

**输出**：
- 推荐股票：控制台输出 + CSV 文件
- CSV 路径：`assets/daily_prediction_YYYYMMDD.csv`
- 日志文件：`assets/daily_prediction.log`

**执行频率**：每日收盘后执行。

---

## 📈 选股结果解读

### 示例输出（2026-02-01）

```
总预测股票数: 177
符合阈值股票数: 2 (阈值 0.6499)

📊 推荐买入股票（按置信度排序）:
  001316.SZ | 日期: 20260130 | 收盘价: 51.02 | 置信度: 0.7009
  301073.SZ | 日期: 20260130 | 收盘价: 30.26 | 置信度: 0.6693
```

**解读**：
- 从 200 只股票中筛选出 **2 只最优质股票**
- 精确率 62.50%：每买 10 只，有 6 只会大涨（+5%）
- 置信度越高，上涨概率越大

---

## ⚠️ 风险控制

### 1. 仓位管理
- **单只股票**：建议仓位不超过 **5%**
- **总仓位**：建议控制在 **30-50%**
- **分散投资**：即使只有 2 只推荐，也建议分批建仓

### 2. 止损策略
- **止损点**：-8% 至 -10%
- **止盈点**：+8% 至 +15%
- **持有周期**：3-5 个交易日

### 3. 环境判断
- **牛市**：可适当提高仓位（50-70%）
- **熊市**：严格控制仓位（20-30%）或观望
- **震荡市**：保持中等仓位（30-50%）

---

## 🔧 配置文件说明

### `config/atm_strategy_config.json`

```json
{
    "model_path": "/workspace/projects/assets/models/主力资金驱动-高置信度策略_model.pkl",
    "prediction_threshold": 0.6498849987983704,
    "expected_precision": 0.625,
    "updated_at": "2026-02-01 00:37:39"
}
```

**字段说明**：
- `model_path`：模型文件路径
- `prediction_threshold`：最佳阈值（自动计算）
- `expected_precision`：预期精确率（62.5%）
- `updated_at`：上次更新时间

---

## 📊 性能监控

### 关键指标

| 指标 | 当前值 | 目标值 |
|------|--------|--------|
| 精确率 | 62.50% | ≥ 60% |
| 召回率 | 1.98% | ≥ 1% |
| 阈值 | 0.6499 | 0.6-0.8 |

### 性能下降怎么办？

1. **重新优化阈值**：运行 `optimize_threshold.py`
2. **重新训练模型**：运行 `train_auto_optuna.py`
3. **检查数据**：确认数据完整性（资金流、复权因子）

---

## 🎯 实战建议

### 买入时机
- **开盘后 30 分钟**：观察股价走势
- **回踩支撑位**：不追高，等待回调
- **分批建仓**：分 2-3 次买入

### 卖出时机
- **止盈**：达到目标收益（+8%~15%）
- **止损**：跌破止损线（-8%~-10%）
- **信号失效**：连续 3 日未达到目标涨幅

### 组合管理
- **持股数量**：建议 2-5 只
- **行业分散**：避免同一板块集中
- **大小结合**：大盘股 + 中小盘股

---

## 📝 常见问题

### Q1：为什么选出的股票这么少？
**A**：这是"自动提款机"模式的特点 - **宁缺毋滥**。精确率 62.5% 意味着每买 10 只有 6 只会大涨，大幅降低试错成本。

### Q2：阈值多久调整一次？
**A**：建议每月调整一次，根据市场变化重新计算最佳阈值。

### Q3：如果没有股票推荐怎么办？
**A**：说明当前市场机会较少，建议空仓或低仓位观望，等待更好的时机。

### Q4：需要回测验证吗？
**A**：强烈建议！使用历史数据验证策略有效性，定期回测（每月一次）。

---

## 🔄 维护清单

### 每日
- [ ] 运行 `daily_prediction.py` 获取推荐股票
- [ ] 更新交易日志
- [ ] 监控持仓股票表现

### 每周
- [ ] 统计本周胜率
- [ ] 分析失败案例
- [ ] 调整仓位策略

### 每月
- [ ] 运行 `optimize_threshold.py` 重新优化阈值
- [ ] 回测验证策略表现
- [ ] 检查数据完整性

### 每季
- [ ] 重新训练模型（市场结构变化时）
- [ ] 评估策略有效性
- [ ] 调整特征工程

---

## 📞 技术支持

- 训练脚本：`scripts/train_auto_optuna.py`
- 阈值优化：`scripts/optimize_threshold.py`
- 日常选股：`scripts/daily_prediction.py`
- 配置文件：`config/atm_strategy_config.json`
- 日志目录：`assets/threshold_*.log`

---

## ⚡ 版本信息

- **模式名称**：自动提款机（ATM Strategy）
- **版本**：V5.1.0
- **更新日期**：2026-02-01
- **模型**：XGBoost 3.1.3 + Optuna 4.7.0
- **精确率**：62.50%
- **召回率**：1.98%

---

**免责声明**：
本策略仅供学习研究使用，不构成投资建议。股市有风险，投资需谨慎。请根据自身风险承受能力理性投资。
