# 🚀 快速开始指南

## 前提条件

1. **Python 环境**: Python 3.8+
2. **Tushare Token**: 需要有效的 Tushare API Token（积分 2000+ 以获取资金流数据）
3. **依赖包**: pandas, numpy, xgboost, optuna, tushare, scikit-learn

## 第一步：配置 Token

### 方法 1：使用环境变量（推荐）
```bash
export TUSHARE_TOKEN="your_token_here"
```

### 方法 2：配置文件
编辑 `config/tushare_config.json`:
```json
{
  "token": "your_token_here",
  "max_workers": 5,
  "timeout": 30,
  "retry_count": 3,
  "rate_limit_delay": 0.1,
  "cache_expiry_hours": 24
}
```

## 第二步：安装依赖

```bash
pip install pandas numpy xgboost optuna tushare scikit-learn
```

## 第三步：清理旧缓存（可选但推荐）

由于数据结构发生变化，建议清理旧缓存：
```bash
rm -rf assets/data/market_cache/*.pkl
```

## 第四步：测试改进功能

运行测试脚本，验证改进是否正常工作：
```bash
python scripts/test_improvements.py
```

**预期输出**:
- ✓ 数据采集成功
- ✓ 检测到资金流数据（如果 Tushare 积分足够）
- ✓ 检测到复权因子
- ✓ 检测到换手率
- ✓ 特征工程完成
- ✓ 数据质量检查通过

## 第五步：训练模型

运行训练脚本，使用 Optuna 自动调参：
```bash
python scripts/train_auto_optuna.py
```

**预期耗时**: 10-30 分钟（取决于网络和计算资源）

**输出位置**: `assets/models/主力资金驱动-高置信度策略_model.pkl`

## 第六步：查看训练结果

训练完成后，脚本会输出：
1. 最佳参数
2. 测试集性能指标（精确率、召回率、F1、AUC）
3. Top 10 重要特征
4. 混淆矩阵

**预期性能**:
- AUC: 0.68-0.78
- 精确率: 55-65%
- 召回率: 20-30%
- F1 分数: 0.30-0.45

## 🔍 常见问题

### Q1: 提示"未检测到资金流数据"
**A**: 这表示您的 Tushare 积分不足以调用 `moneyflow` 接口。系统会自动使用代理指标（OBV 等），但效果会略差。建议升级 Tushare 积分至 2000+。

### Q2: 提示"未检测到复权因子"
**A**: 检查数据采集是否成功。可能是网络问题或 Tushare 服务暂时不可用。

### Q3: 训练时间过长
**A**:
- 减少 `n_stocks` 数量（配置文件中）
- 减少 `n_trials` 次数（配置文件中）
- 使用更快的计算资源

### Q4: 模型性能仍不达标
**A**:
- 检查数据质量（是否包含足够的交易日）
- 调整 `min_return_threshold`（标签阈值）
- 增加 `scale_pos_weight`（样本权重）
- 尝试不同的特征组合

## 📊 监控训练进度

训练过程中，Optuna 会显示实时进度：
```
[I 2026-01-31 20:31:08,123] Trial 0 finished with value: 0.3456 and parameters: {...}
[I 2026-01-31 20:31:09,234] Trial 1 finished with value: 0.3678 and parameters: {...}
...
```

## 💾 模型保存位置

训练完成后，模型保存在：
```
assets/models/主力资金驱动-高置信度策略_model.pkl
```

模型文件包含：
- 训练好的模型
- 最佳参数
- 特征列表
- 性能指标
- 特征重要性

## 🎯 下一步

训练成功后，您可以：

1. **实盘预测**: 创建 `predict_today.py` 脚本，每日运行获取推荐股票
2. **回测验证**: 使用历史数据验证策略的有效性
3. **参数微调**: 根据实际表现调整参数
4. **特征优化**: 添加更多有效特征

## 📞 技术支持

如有问题，请参考：
- `assets/对话5改进说明.md` - 详细的改进说明
- `assets/对话5.txt` - 原始问题诊断
- Tushare 文档: https://tushare.pro/document/2
- XGBoost 文档: https://xgboost.readthedocs.io/

祝您训练顺利！🎉
