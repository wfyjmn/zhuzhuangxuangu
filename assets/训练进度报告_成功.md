========================================
✓ 训练成功启动！
========================================

启动时间: 2026-01-31 21:56:28
当前时间: 2026-01-31 21:58
运行时长: 约 2 分钟

========================================
问题修复记录
========================================

问题 1: 数据准备失败（没有获取到有效数据）
- 原因: 股票池中包含约 14% 的北交所（BJ）股票
- 解决: 添加 exclude_markets 参数，排除北交所股票

问题 2: 特征工程失败（缺少必要列 volume）
- 原因: Tushare 数据列名是 'vol'，而特征工程期望 'volume'
- 解决: 在 data_collector.py 中添加列名映射（vol -> volume, ts_code -> stock_code）

========================================
数据集统计
========================================

✓ 数据采集完成
  - 股票池: 300 只股票（排除北交所后）
  - 成功采集: 约 169 只股票（数据充足的股票）
  - 总样本数: 138,744 条

✓ 特征工程完成
  - 特征数: 24 个
  - 检测到真实资金流数据 ✓
  - 使用复权价格计算技术指标 ✓

✓ 标签分布
  - 正样本数: 5,781（4.17%）
  - 负样本数: 132,963（95.83%）
  - 标签阈值: 未来 3-5 日收益率 ≥ 5%

✓ 数据集划分
  - 训练集: 117,932 样本（85%）
  - 测试集: 20,812 样本（15%）

========================================
Optuna 超参数优化
========================================

状态: 进行中（0/100）

优化目标: F1 Score
- 优点: 同时优化精确率和召回率
- 预期: 解决召回率低的问题

搜索空间:
- 学习率: 0.01 - 0.1
- 树深度: 3 - 6
- 树数量: 500 - 1500
- 样本权重: 3.0 - 8.0（强制重视正样本）

========================================
预计时间线
========================================

✅ 数据采集（已完成）
✅ 特征工程（已完成）

⏳ 超参数优化（进行中）
  - 当前进度: 0/100
  - 预计耗时: 10-20 分钟

⏳ 最终训练
  - 使用最佳参数训练
  - 预计耗时: 2-5 分钟

⏳ 模型评估
  - 性能指标计算
  - 预计耗时: 1-2 分钟

总计: 约 15-30 分钟

========================================
预期性能
========================================

目标指标:
- AUC: 0.68-0.78
- 精确率: 55-65%
- 召回率: 20-30%（相比之前 2.32% 大幅提升）
- F1 分数: 0.30-0.45

========================================
关键改进
========================================

1. 真实资金流数据
   - 之前: 使用 OBV、成交量倍数等代理指标
   - 现在: 使用 Tushare 资金流接口的真实数据

2. 复权价格
   - 之前: 使用原始价格，除权日信号失真
   - 现在: 使用复权价格计算技术指标

3. 样本权重
   - 之前: 未设置样本权重
   - 现在: scale_pos_weight 3.0-8.0，强制模型重视正样本

4. 标签阈值
   - 之前: 3% 收益率
   - 现在: 5% 收益率，只抓大肉

========================================
监控方法
========================================

查看最新日志:
tail -f assets/training_output.log

检查进程:
ps -p 185

========================================
