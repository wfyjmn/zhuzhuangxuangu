========================================
大模型训练核心程序和环境配置清单
========================================

文档时间: 2026-01-31 23:25
项目版本: V4.0.0_RealMoneyFlow

========================================
一、核心训练程序
========================================

1. 训练脚本
   文件: scripts/train_auto_optuna.py
   大小: 16 KB
   功能: Optuna 自动调参训练
   特点:
   - 100 次超参数优化试验
   - 5 折时间序列交叉验证
   - F1 Score 优化（同时关注精确率和召回率）
   - 自动保存最佳模型

2. 数据采集器
   文件: src/stock_system/data_collector.py
   大小: 28 KB
   功能: 从 Tushare 获取 A 股数据
   特点:
   - 获取日线行情数据
   - 获取资金流数据（真实主力资金）
   - 获取复权因子
   - 获取每日指标（PE、PB、换手率等）
   - 智能缓存机制
   - 多线程批量采集
   - 树形筛选股票池
   - 支持排除指定市场（如北交所）

3. 特征工程
   文件: src/stock_system/enhanced_features.py
   大小: 19 KB
   功能: 创建增强版特征
   特点:
   - 104 个综合特征
   - 主力资金特征（30%权重）
   - 北向资金特征（20%权重）
   - 市场情绪特征（20%权重）
   - 技术指标特征（30%权重）
   - 支持复权价格计算
   - 支持真实资金流数据

4. 其他核心模块
   src/stock_system/predictor.py - 模型预测器
   src/stock_system/model_reporter.py - 模型报告生成
   src/stock_system/monitor.py - 模型监控

========================================
二、环境配置文件
========================================

1. 依赖包配置
   文件: requirements.txt
   大小: 2.5 KB
   核心依赖:
   - xgboost==3.1.3（机器学习模型）
   - optuna==4.7.0（超参数优化）
   - pandas==2.2.2（数据处理）
   - numpy==2.2.6（数值计算）
   - scikit-learn==1.8.0（机器学习工具）
   - scipy==1.17.0（科学计算）
   - tushare==1.4.24（数据接口）
   - tqdm==4.67.1（进度条）

   安装命令:
   pip install -r requirements.txt

2. 训练配置
   文件: config/precision_priority_v4_config.json
   大小: 3.7 KB
   内容:
   - 数据范围: 2021-01-01 ~ 2024-01-01
   - 股票数量: 300 只
   - 标签阈值: 5%（未来 3-5 日收益率）
   - 特征列表: 24 个特征
   - Optuna 参数空间
   - XGBoost 模型参数

3. Tushare 配置
   文件: config/tushare_config.json
   大小: 238 字节
   内容:
   - API Base: https://api.tushare.pro
   - 超时: 30 秒
   - 重试次数: 3 次
   - 最大线程数: 5
   - 缓存过期时间: 24 小时
   - Token: （已清空，使用 .env 文件）

4. 环境变量
   文件: .env
   大小: 142 字节
   内容:
   - TUSHARE_TOKEN=your_token_here

   注意:
   - .env 文件不在 Git 仓库中
   - 需要手动创建并配置 Token
   - Token 可从 Tushare 官网获取

========================================
三、核心依赖包详解
========================================

1. 机器学习框架
   xgboost==3.1.3
   - 梯度提升树模型
   - 支持 GPU 加速
   - 处理结构化数据
   - 速度快，性能好

   scikit-learn==1.8.0
   - 机器学习工具包
   - 提供评估指标
   - 数据预处理
   - 模型验证

2. 超参数优化
   optuna==4.7.0
   - 自动超参数优化
   - 贝叶斯优化算法
   - 支持多种采样策略
   - 可视化工具

3. 数据处理
   pandas==2.2.2
   - 数据分析和处理
   - DataFrame 数据结构
   - 时间序列处理
   - 数据清洗

   numpy==2.2.6
   - 数值计算库
   - 矩阵运算
   - 数学函数
   - 性能优化

4. 数据接口
   tushare==1.4.24
   - A 股数据接口
   - 提供历史行情
   - 提供财务数据
   - 提供资金流数据

5. 其他工具
   tqdm==4.67.1
   - 进度条显示
   - 训练进度可视化

   pyyaml==6.0.3
   - YAML 配置文件解析

========================================
四、关键配置参数
========================================

1. 数据配置
   start_date: 2021-01-01
   end_date: 2024-01-01
   n_stocks: 300
   min_return_threshold: 0.05（5% 收益率）
   prediction_days: [3, 5]

2. Optuna 配置
   n_trials: 100（试验次数）
   timeout: 7200（超时时间 2 小时）
   direction: maximize（最大化目标）
   metric: f1（优化指标）
   cv_folds: 5（交叉验证折数）

3. XGBoost 参数空间
   learning_rate: 0.01-0.1
   max_depth: 3-6
   min_child_weight: 10-30
   n_estimators: 500-1500
   scale_pos_weight: 3.0-8.0
   subsample: 0.6-0.9
   colsample_bytree: 0.6-0.9
   reg_alpha: 0.1-10.0
   reg_lambda: 0.1-10.0
   gamma: 0.0-5.0

4. 模型配置
   objective: binary:logistic
   eval_metric: [auc, logloss]
   tree_method: hist
   n_jobs: -1（使用所有 CPU 核心）
   random_state: 42

========================================
五、训练流程
========================================

步骤 1: 准备环境
   1. 创建 .env 文件
      echo "TUSHARE_TOKEN=your_token_here" > .env

   2. 安装依赖
      pip install -r requirements.txt

步骤 2: 运行训练
   python3 scripts/train_auto_optuna.py

步骤 3: 训练流程
   1. 加载配置文件
   2. 获取股票池（300 只）
   3. 采集数据（日线、资金流、复权因子）
   4. 特征工程（104 个特征）
   5. 生成标签（5% 收益率阈值）
   6. 数据集划分（训练 85%，测试 15%）
   7. Optuna 超参数优化（100 次试验）
   8. 训练最终模型
   9. 评估模型性能
   10. 保存最佳模型

步骤 4: 查看结果
   - 模型文件: assets/models/主力资金驱动-高置信度策略_model.pkl
   - 训练日志: assets/training_output.log
   - 训练报告: assets/训练完成报告.md

========================================
六、性能指标
========================================

训练时间: 约 70 分钟
试验次数: 100 次
CPU 使用率: 40-45%
内存使用率: 19%

最终性能:
- AUC: 0.9470
- 精确率: 26.57%
- 召回率: 77.21%
- F1: 0.3954

最佳参数:
- learning_rate: 0.0100
- max_depth: 4
- n_estimators: 583
- scale_pos_weight: 4.62

========================================
七、文件清单
========================================

核心程序:
- scripts/train_auto_optuna.py (16 KB)
- src/stock_system/data_collector.py (28 KB)
- src/stock_system/enhanced_features.py (19 KB)

配置文件:
- requirements.txt (2.5 KB)
- config/precision_priority_v4_config.json (3.7 KB)
- config/tushare_config.json (238 B)
- .env (142 B)

输出文件:
- assets/models/主力资金驱动-高置信度策略_model.pkl (636 KB)
- assets/training_output.log (279 KB)
- assets/训练完成报告.md

========================================
八、环境要求
========================================

系统要求:
- 操作系统: Linux / macOS / Windows
- Python 版本: 3.8+
- 内存: 建议 4GB+
- CPU: 建议 4 核心以上
- 磁盘: 建议 10GB+（包含数据缓存）

Python 依赖:
- Python 3.8+
- pip 20.0+

网络要求:
- 需要访问 Tushare API
- 稳定的网络连接
- API 频率限制（普通用户 200 次/分钟）

========================================
九、快速开始
========================================

1. 克隆项目
   git clone https://github.com/wfyjmn/zhuzhuangxuagu.git
   cd zhuzhuangxuagu

2. 创建 .env 文件
   echo "TUSHARE_TOKEN=your_token_here" > .env

3. 安装依赖
   pip install -r requirements.txt

4. 运行训练
   python3 scripts/train_auto_optuna.py

5. 查看结果
   cat assets/training完成报告.md

========================================
十、故障排除
========================================

问题 1: 模块导入错误
   解决: pip install -r requirements.txt

问题 2: Tushare Token 无效
   解决: 检查 .env 文件中的 Token 是否正确

问题 3: 数据采集超时
   解决: 检查网络连接，或调整 config/tushare_config.json 中的 timeout

问题 4: 内存不足
   解决: 减少股票数量（config/precision_priority_v4_config.json 中的 n_stocks）

问题 5: 训练速度慢
   解决: 增加 config/tushare_config.json 中的 max_workers

========================================
