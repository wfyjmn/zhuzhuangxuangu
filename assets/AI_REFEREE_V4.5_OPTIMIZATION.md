# AIè£åˆ¤ç³»ç»Ÿä¼˜åŒ–æ–‡æ¡£ï¼ˆV4.5ï¼‰

## æ›´æ–°æ¦‚è¿°

ç‰ˆæœ¬ï¼šV4.4 â†’ V4.5  
æ›´æ–°æ—¥æœŸï¼š2025-01-29  
ä¼˜åŒ–ç±»å‹ï¼šåŠŸèƒ½å¢å¼ºä¸ä»£ç ä¼˜åŒ–

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

åœ¨ V4.4 ç‰ˆæœ¬ä¿®å¤äº†å››ä¸ªä¸¥é‡é—®é¢˜åï¼ŒV4.5 ç‰ˆæœ¬ä¸»è¦èšç„¦äºï¼š

1. **å¼•å…¥å¤šæŠ˜æ—¶åºäº¤å‰éªŒè¯**ï¼ˆæ¯”å•æ¬¡åˆ‡åˆ†æ›´ç¨³å¥ï¼‰
2. **ä¼˜åŒ–é»˜è®¤å‚æ•°**ï¼ˆæ›´ä¿å®ˆï¼Œé¿å…è¿‡æ‹Ÿåˆï¼‰
3. **æ”¹è¿›ä»£ç ç»“æ„**ï¼ˆåŠ¨æ€åˆ›å»ºæ¨¡å‹å®ä¾‹ï¼Œæ›´çµæ´»ï¼‰
4. **å¢å¼ºæµ‹è¯•è¦†ç›–**ï¼ˆæ–°å¢ train_time_series æµ‹è¯•ï¼‰

---

## ğŸš€ ä¸»è¦æ”¹è¿›

### 1. æ–°å¢ `train_time_series()` æ–¹æ³•

**åŠŸèƒ½**ï¼š
- ä½¿ç”¨ `TimeSeriesSplit` è¿›è¡Œå¤šæŠ˜æ—¶åºäº¤å‰éªŒè¯
- æ¯ä¸ª Fold éƒ½æœ‰ç‹¬ç«‹çš„è®­ç»ƒé›†å’ŒéªŒè¯é›†
- ä¿ç•™æœ€åä¸€ä¸ª Fold çš„æ¨¡å‹ï¼ˆå› ä¸ºå®ƒçœ‹è¿‡çš„å†å²æ•°æ®æœ€å¤šï¼‰

**ä¼˜åŠ¿**ï¼š
- âœ… æ¯”å•æ¬¡åˆ‡åˆ†æ›´ç¨³å¥
- âœ… é¿å…å› æ•°æ®åˆ’åˆ†åå·®å¯¼è‡´çš„è¯„ä¼°ä¸å‡†ç¡®
- âœ… æä¾›æ›´å…¨é¢çš„æ¨¡å‹æ€§èƒ½è¯„ä¼°
- âœ… è‡ªåŠ¨å¤„ç†æ—¶åºåˆ‡åˆ†ï¼Œé¿å…æ•°æ®æ³„éœ²

**ä½¿ç”¨æ–¹æ³•**ï¼š
```python
from ai_referee import AIReferee

# åˆå§‹åŒ–
referee = AIReferee(model_type='xgboost')

# æ—¶åºäº¤å‰éªŒè¯è®­ç»ƒï¼ˆæ¨èï¼‰
fold_results = referee.train_time_series(X, Y, n_splits=5)
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
================================================================================
[AIè£åˆ¤] æ—¶åºäº¤å‰éªŒè¯è®­ç»ƒ (n_splits=5)
================================================================================
[æ ·æœ¬ç»Ÿè®¡] æ€»æ ·æœ¬: 10000, æ­£æ ·æœ¬: 3000, è´Ÿæ ·æœ¬: 7000
[æ ·æœ¬å¹³è¡¡] æ­£æ ·æœ¬å æ¯”: 30.0%, scale_pos_weight: 2.33

================================================================================
[Fold 1/5] æ—¶åºäº¤å‰éªŒè¯
================================================================================
[æ—¶é—´èŒƒå›´]
  è®­ç»ƒé›†: 2023-01-01 ~ 2023-04-30 (2000 æ ·æœ¬)
  éªŒè¯é›†: 2023-05-01 ~ 2023-06-30 (500 æ ·æœ¬)
[è®­ç»ƒä¸­]...
[è¯„ä¼°æŒ‡æ ‡]
  å‡†ç¡®ç‡ï¼ˆAccuracyï¼‰: 0.7200
  ç²¾ç¡®ç‡ï¼ˆPrecisionï¼‰: 0.6500
  å¬å›ç‡ï¼ˆRecallï¼‰: 0.5500
  F1åˆ†æ•°: 0.5957
  AUCåˆ†æ•°: 0.7500

...ï¼ˆæ›´å¤š Foldï¼‰

================================================================================
[è®­ç»ƒå®Œæˆ] äº¤å‰éªŒè¯æ±‡æ€»
================================================================================
[å¹³å‡æŒ‡æ ‡]
  å‡†ç¡®ç‡ï¼ˆAccuracyï¼‰: 0.7150 (+/- 0.0150)
  ç²¾ç¡®ç‡ï¼ˆPrecisionï¼‰: 0.6450 (+/- 0.0120)
  å¬å›ç‡ï¼ˆRecallï¼‰: 0.5350 (+/- 0.0180)
  F1åˆ†æ•°: 0.5850 (+/- 0.0140)
  AUCåˆ†æ•°: 0.7450 (+/- 0.0100)

[æ¨¡å‹é€‰æ‹©]
  å·²ä¿å­˜ç¬¬ 5 Fold çš„æ¨¡å‹ï¼ˆçœ‹è¿‡çš„å†å²æ•°æ®æœ€å¤šï¼‰
  AUCåˆ†æ•°: 0.7600
```

---

### 2. ä¼˜åŒ–é»˜è®¤å‚æ•°

**å˜æ›´å†…å®¹**ï¼š

| å‚æ•° | V4.4 | V4.5 | åŸå›  |
|------|------|------|------|
| n_estimators | 100 | 200 | å¢åŠ æ ‘çš„æ•°é‡ï¼Œæé«˜æ¨¡å‹è¡¨è¾¾èƒ½åŠ› |
| max_depth | 6 | 5 | é™ä½æ·±åº¦ï¼Œé¿å…è¿‡æ‹Ÿåˆ |
| learning_rate | 0.1 | 0.05 | é™ä½å­¦ä¹ ç‡ï¼Œæ›´ç¨³å¥ |

**ä¼˜åŠ¿**ï¼š
- âœ… æ›´ä¿å®ˆçš„å‚æ•°ï¼Œé™ä½è¿‡æ‹Ÿåˆé£é™©
- âœ… æ›´ä½çš„ learning_rate éœ€è¦æ›´å¤šçš„æ ‘ï¼ˆ200ï¼‰ï¼Œå› æ­¤åŒæ­¥è°ƒæ•´
- âœ… æ›´é€‚åˆé‡åŒ–äº¤æ˜“çš„å®ç›˜åœºæ™¯ï¼ˆæ³›åŒ–èƒ½åŠ›æ›´é‡è¦ï¼‰

**ä»£ç å˜æ›´**ï¼š
```python
# V4.4
params = {
    'n_estimators': 100,
    'max_depth': 6,
    'learning_rate': 0.1,
    ...
}

# V4.5
params = {
    'n_estimators': 200,  # å¢åŠ æ ‘çš„æ•°é‡
    'max_depth': 5,       # é™ä½æ·±åº¦
    'learning_rate': 0.05,  # é™ä½å­¦ä¹ ç‡
    ...
}
```

---

### 3. æ”¹è¿›ä»£ç ç»“æ„

**æ–°å¢ `_get_default_params()` æ–¹æ³•**ï¼š
- å°†é»˜è®¤å‚æ•°æå–åˆ°ç‹¬ç«‹æ–¹æ³•
- ä¾¿äºç»Ÿä¸€ç®¡ç†å’Œä¿®æ”¹

**æ–°å¢ `_get_model_instance()` æ–¹æ³•**ï¼š
- åŠ¨æ€åˆ›å»ºæ¨¡å‹å®ä¾‹
- æ”¯æŒå‚æ•°è¦†ç›–
- æ¯ä¸ª Fold å¯ä»¥åˆ›å»ºç‹¬ç«‹çš„æ¨¡å‹å®ä¾‹

**ä¼˜åŠ¿**ï¼š
- âœ… ä»£ç æ›´æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
- âœ… æ›´çµæ´»ï¼Œæ”¯æŒåŠ¨æ€å‚æ•°è°ƒæ•´
- âœ… ä¾¿äºæ‰©å±•æ–°çš„æ¨¡å‹ç±»å‹

**ä»£ç ç¤ºä¾‹**ï¼š
```python
# è·å–é»˜è®¤å‚æ•°
default_params = self._get_default_params()

# åˆ›å»ºæ¨¡å‹å®ä¾‹ï¼ˆå¸¦å‚æ•°è¦†ç›–ï¼‰
model = self._get_model_instance({'scale_pos_weight': 2.33})
```

---

### 4. å¢å¼ºæµ‹è¯•è¦†ç›–

**æ–°å¢æµ‹è¯•ç”¨ä¾‹**ï¼š
- æµ‹è¯• `train_time_series()` æ–¹æ³•
- å¯¹æ¯”å•æ¬¡åˆ‡åˆ†å’Œæ—¶åºäº¤å‰éªŒè¯çš„ç»“æœ
- éªŒè¯æ¨¡å‹åŠ è½½å’Œé¢„æµ‹çš„ä¸€è‡´æ€§

**æµ‹è¯•è¾“å‡ºç¤ºä¾‹**ï¼š
```
================================================================================
[æµ‹è¯•1] å•æ¬¡æ—¶åºåˆ‡åˆ†è®­ç»ƒï¼ˆä¿ç•™å‘åå…¼å®¹ï¼‰
================================================================================
...

[æµ‹è¯•2] æ—¶åºäº¤å‰éªŒè¯è®­ç»ƒï¼ˆæ¨èä½¿ç”¨ï¼‰
================================================================================
...

================================================================================
[å¯¹æ¯”] å•æ¬¡åˆ‡åˆ† vs æ—¶åºäº¤å‰éªŒè¯
================================================================================
å•æ¬¡åˆ‡åˆ† AUC: 0.7500
æ—¶åºäº¤å‰ AUC: 0.7450 (+/- 0.0100)
```

---

## ğŸ“Š ä¼˜åŒ–å‰åå¯¹æ¯”

| åŠŸèƒ½ | V4.4 | V4.5 |
|------|------|------|
| è®­ç»ƒæ–¹æ³• | å•æ¬¡æ—¶åºåˆ‡åˆ† | å•æ¬¡åˆ‡åˆ† + æ—¶åºäº¤å‰éªŒè¯ |
| é»˜è®¤å‚æ•° | n_estimators=100, lr=0.1 | n_estimators=200, lr=0.05 |
| æ¨¡å‹åˆ›å»º | åœ¨ `__init__` ä¸­åˆ›å»º | åŠ¨æ€åˆ›å»ºï¼ˆ`_get_model_instance`ï¼‰ |
| æµ‹è¯•è¦†ç›– | åŸºç¡€æµ‹è¯• | å¢å¼ºæµ‹è¯•ï¼ˆå¯¹æ¯”ä¸¤ç§æ–¹æ³•ï¼‰ |
| ç¨³å¥æ€§ | ä¸€èˆ¬ | é«˜ï¼ˆå¤šæŠ˜éªŒè¯ï¼‰ |

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### 1. TimeSeriesSplit åŸç†

```python
from sklearn.model_selection import TimeSeriesSplit

tscv = TimeSeriesSplit(n_splits=5)

# åˆ‡åˆ†æ–¹å¼
# Fold 1: Train [0-20%), Val [20-40%)
# Fold 2: Train [0-40%), Val [40-60%)
# Fold 3: Train [0-60%), Val [60-80%)
# Fold 4: Train [0-80%), Val [80-90%)
# Fold 5: Train [0-90%), Val [90-100%)
```

**ä¼˜åŠ¿**ï¼š
- è®­ç»ƒé›†å§‹ç»ˆåœ¨éªŒè¯é›†ä¹‹å‰ï¼ˆç¬¦åˆæ—¶åºé€»è¾‘ï¼‰
- æ¯ä¸ª Fold éƒ½æœ‰ä¸åŒçš„è®­ç»ƒ/éªŒè¯æ¯”ä¾‹
- æœ€åä¸€ä¸ª Fold çš„æ¨¡å‹çœ‹è¿‡çš„å†å²æ•°æ®æœ€å¤š

### 2. åŠ¨æ€åˆ›å»ºæ¨¡å‹å®ä¾‹

```python
# ä¼ ç»Ÿæ–¹å¼ï¼ˆV4.4ï¼‰
def __init__(self, model_type):
    self.model = self._init_model()  # åœ¨åˆå§‹åŒ–æ—¶åˆ›å»º

# åŠ¨æ€æ–¹å¼ï¼ˆV4.5ï¼‰
def train_time_series(self, X, Y, n_splits=5):
    for fold, (train_idx, val_idx) in enumerate(tscv.split(X)):
        # æ¯ä¸ª Fold åˆ›å»ºç‹¬ç«‹çš„æ¨¡å‹å®ä¾‹
        model = self._get_model_instance()
        model.fit(X_train, y_train)
```

**ä¼˜åŠ¿**ï¼š
- æ¯ä¸ª Fold çš„æ¨¡å‹å®Œå…¨ç‹¬ç«‹
- å¯ä»¥é’ˆå¯¹æ¯ä¸ª Fold è°ƒæ•´å‚æ•°
- é¿å…æ¨¡å‹çŠ¶æ€æ±¡æŸ“

### 3. å‚æ•°ä¼˜åŒ–

**ä¿å®ˆå‚æ•°çš„åŸå› **ï¼š
- é‡åŒ–äº¤æ˜“ä¸­ï¼Œ**æ³›åŒ–èƒ½åŠ› > æ‹Ÿåˆèƒ½åŠ›**
- è¿‡æ‹Ÿåˆçš„æ¨¡å‹åœ¨å®ç›˜ä¸­ä¼šå¤±æ•ˆ
- æ›´ä½çš„ learning_rate éœ€è¦æ›´å¤šçš„æ ‘æ¥è¡¥å¿

**å‚æ•°è°ƒæ•´åŸåˆ™**ï¼š
- é™ä½ learning_rate â†’ å¢åŠ  n_estimators
- é™ä½ max_depth â†’ é¿å…è¿‡æ‹Ÿåˆ
- ä¿æŒ subsample å’Œ colsample_bytree â‰ˆ 0.8ï¼ˆæ ‡å‡†é…ç½®ï¼‰

---

## ğŸ“ ä½¿ç”¨æŒ‡å—

### æ¨èä½¿ç”¨æ–¹å¼

```python
from ai_referee import AIReferee
import pandas as pd

# 1. å‡†å¤‡æ•°æ®ï¼ˆå¿…é¡»åŒ…å« trade_date åˆ—ï¼‰
X = pd.read_csv('training_features.csv')  # åŒ…å« trade_date åˆ—
Y = pd.read_csv('training_labels.csv')['label']

# 2. åˆå§‹åŒ–
referee = AIReferee(model_type='xgboost')

# 3. æ—¶åºäº¤å‰éªŒè¯è®­ç»ƒï¼ˆæ¨èï¼‰
fold_results = referee.train_time_series(X, Y, n_splits=5)

# 4. é¢„æµ‹
test_X = pd.read_csv('test_features.csv')
probabilities = referee.predict(test_X)

# 5. ä¿å­˜æ¨¡å‹
model_file = referee.save_model()

# 6. åŠ è½½æ¨¡å‹
new_referee = AIReferee()
new_referee.load_model(model_file)
```

### å‘åå…¼å®¹

```python
# V4.4 çš„å•æ¬¡åˆ‡åˆ†æ–¹æ³•ä»ç„¶å¯ç”¨
referee = AIReferee(model_type='xgboost')
referee.train(X, Y, validation_split=0.2)  # ä¿ç•™å‘åå…¼å®¹
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å¿…é¡»åŒ…å« trade_date åˆ—

```python
# âŒ é”™è¯¯ï¼šç¼ºå°‘ trade_date åˆ—
X = pd.DataFrame({'feature1': [...], 'feature2': [...]})
referee.train_time_series(X, Y)  # æŠ›å‡ºå¼‚å¸¸

# âœ… æ­£ç¡®ï¼šåŒ…å« trade_date åˆ—
X = pd.DataFrame({
    'trade_date': ['20230101', '20230102', ...],
    'feature1': [...],
    'feature2': [...]
})
referee.train_time_series(X, Y)  # æ­£å¸¸æ‰§è¡Œ
```

### 2. æ—¶é—´æ’åº

```python
# âœ… è‡ªåŠ¨æ’åºï¼ˆtrain_time_series å†…éƒ¨ä¼šæ’åºï¼‰
X = pd.DataFrame({'trade_date': ['20230105', '20230101', ...]})
referee.train_time_series(X, Y)  # è‡ªåŠ¨æŒ‰ trade_date æ’åº
```

### 3. å‚æ•°å¯¹æ¯”

| å‚æ•° | å•æ¬¡åˆ‡åˆ† (`train`) | æ—¶åºäº¤å‰éªŒè¯ (`train_time_series`) |
|------|-------------------|----------------------------------|
| validation_split | 0.2ï¼ˆé»˜è®¤ï¼‰ | ä¸é€‚ç”¨ |
| n_splits | ä¸é€‚ç”¨ | 5ï¼ˆé»˜è®¤ï¼‰ |
| è¾“å‡ºç»“æœ | å•æ¬¡è¯„ä¼° | 5æŠ˜è¯„ä¼° + å¹³å‡æŒ‡æ ‡ |
| æ¨¡å‹é€‰æ‹© | éªŒè¯é›†ä¸Šçš„æ¨¡å‹ | æœ€åä¸€ä¸ª Fold çš„æ¨¡å‹ |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [AIè£åˆ¤ç³»ç»Ÿä½¿ç”¨æ–‡æ¡£](AI_REFEREE_README.md)
- [AIè£åˆ¤ç³»ç»Ÿå®ç°æ€»ç»“](AI_REFEREE_IMPLEMENTATION_SUMMARY.md)
- [AIè£åˆ¤ç³»ç»Ÿä¼˜åŒ–æ–‡æ¡£ï¼ˆV4.4ï¼‰](AI_REFEREE_OPTIMIZATION.md)
- [FeatureExtractor ä¼˜åŒ–æ–‡æ¡£](FEATURE_EXTRACTOR_OPTIMIZATION.md)
- [DataWarehouse ä¼˜åŒ–æ–‡æ¡£](DATA_WAREHOUSE_OPTIMIZATION.md)
- [BacktestGenerator ä¼˜åŒ–æ–‡æ¡£](BACKTEST_GENERATOR_OPTIMIZATION.md)

---

## ğŸ¯ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¼˜åŒ–å†…å®¹ |
|------|------|----------|
| V4.0 | 2025-01-27 | åˆå§‹ç‰ˆæœ¬ï¼Œå®ç° AI è£åˆ¤åŸºæœ¬åŠŸèƒ½ |
| V4.1 | 2025-01-28 | DataWarehouse ä¼˜åŒ– |
| V4.2 | 2025-01-28 | FeatureExtractor ä¼˜åŒ– |
| V4.3 | 2025-01-28 | BacktestGenerator ä¼˜åŒ– |
| V4.4 | 2025-01-29 | ä¿®å¤å››ä¸ªä¸¥é‡é—®é¢˜ï¼ˆæ•°æ®æ³„éœ²ã€æ—¶åºåˆ‡åˆ†ã€ç¼ºå¤±å€¼ã€ä¸å¹³è¡¡æ ·æœ¬ï¼‰ |
| V4.5 | 2025-01-29 | å¼•å…¥å¤šæŠ˜æ—¶åºäº¤å‰éªŒè¯ã€ä¼˜åŒ–é»˜è®¤å‚æ•°ã€æ”¹è¿›ä»£ç ç»“æ„ |

---

## ğŸ† æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›

1. **æ—¶åºäº¤å‰éªŒè¯**ï¼šæ¯”å•æ¬¡åˆ‡åˆ†æ›´ç¨³å¥ï¼Œæä¾›æ›´å…¨é¢çš„è¯„ä¼°
2. **ä¼˜åŒ–å‚æ•°**ï¼šæ›´ä¿å®ˆçš„å‚æ•°ï¼Œé™ä½è¿‡æ‹Ÿåˆé£é™©
3. **ä»£ç ç»“æ„**ï¼šåŠ¨æ€åˆ›å»ºæ¨¡å‹å®ä¾‹ï¼Œæ›´çµæ´»
4. **æµ‹è¯•è¦†ç›–**ï¼šå¢å¼ºæµ‹è¯•ï¼Œç¡®ä¿ä»£ç è´¨é‡

### æ¨èä½¿ç”¨

- **è®­ç»ƒé˜¶æ®µ**ï¼šä½¿ç”¨ `train_time_series()`ï¼ˆæ›´ç¨³å¥ï¼‰
- **å¿«é€ŸéªŒè¯**ï¼šä½¿ç”¨ `train()`ï¼ˆæ›´å¿«ï¼‰
- **å®ç›˜éƒ¨ç½²**ï¼šä½¿ç”¨ `load_model()` åŠ è½½å·²è®­ç»ƒæ¨¡å‹

---

**ç‰ˆæœ¬æ›´æ–°**ï¼šV4.4 â†’ V4.5  
**ä¼˜åŒ–æ—¥æœŸ**ï¼š2025-01-29  
**çŠ¶æ€**ï¼šâœ… å®Œæˆ  
**æ€»ä¼˜åŒ–é—®é¢˜æ•°**ï¼š**10 ä¸ªè‡´å‘½/ä¸¥é‡é—®é¢˜** + **4 ä¸ªåŠŸèƒ½å¢å¼º**
